# Backtesting the viral Nadaraya-Watson Envelop trading indicator in python

    Too good to be true is often a warning sign, and this is certainly the case with the Nadaraya-Watson indicator, let me explain…

What is Nadaraya-Watson envelope?

The Nadaraya-Watson envelope is a type of moving average calculated by taking a weighted average of data points over a period of time. The envelope is created by drawing two lines (one above and one below) parallel to the moving average at a user-defined percentage distance. Top and bottom lines form a “band” around the moving average that can be used to identify potential trend changes and generate trading signals. The Nadaraya-Watson cover is named after its creators, Vasily Nadaraya and his Geoffrey Watson.

Official: https://www.tradingview.com/script/Iko0E2kL-Nadaraya-Watson-Envelope-LuxAlgo/
Logic

The main computation is done in a ‘for’ loop that iterates over ’n’. At each iteration “i”, a weighted average of the data points is calculated using another inner “for” loop that iterates “j”. The weight “w” is exponentially calculated and depends on the difference between the indices “i” and “j” and the smoothing parameter “h”. The weighted sum of data points is stored in ‘sum’ and the weighted sum of weights is stored in ‘sumw’. The weighted average of the data points for each iteration “i” is computed as the ratio of “sum” and “sumw”. The value “y2[i]” is set to this weighted average at each iteration. The value “y1[i]” is computed as the average of “y2[i]” and “y2[i-1]” for all iterations except the first. This is because the first value of “y1” is undefined. Finally, the arrays ‘y2’ and ‘y1’ are added as new columns to the dataframe ‘df’ contained in the object ‘self’. This function returns arrays “y2” and “y1”.

The function generates buy and sell signals based on the difference between two elements of the Nadaraya-Watson Envelope (y2). If the difference is greater than a threshold and the previous y2 value is below the previous y1 value, it is a buy signal. If the difference is less than the negative of the threshold and the previous y2 value is above the previous y1 value, it is a sell signal. The index of the buy and sell signals are added to separate lists.
Let’s backtest this in python


It is considered trash due to its tendency to “repaint,” which is a tactic used by scamsters to sell indicators on platforms like TradingView. In this context, repainting means dynamically changing signals as new data is added, making the indicator appear more successful than it actually is.

This code does not inherently cause a repaint, but if the self.src data used to compute the Nadaraya-Watson envelopes (y1 and y2) changes dynamically, it will cause a redraw, generated by the gen_signals function. changes the signal received. This can change previous signals and make the indicator appear more successful than it really is. This is the definition of repaint.

    A new free viral indicator from TradingView that looks like a goldmine but is nothing more than a repaint and backtest fooling tool!

Thanks for reading
For error correction or any query or small talks too,
Msg me on: https://www.linkedin.com/in/yashaswa-varshney/
